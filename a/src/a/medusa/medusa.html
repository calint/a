<!DOCTYPE html><meta charset="utf-8"><title>medusa ascii game</title>
<style>
	html{white-space:pre;font-family:courier;font-size:12px;margin:0;padding:0;margin-left:auto;margin-right:auto;padding:0 4em 0 4em;display:block;text-align:center;color:#222;border-right:0px dotted #666;border-left:0px dotted #666;box-shadow:0 0 27px rgba(0,0,0,.5);border-radius:1px}
	#scr{outline:0;border:1px solid gray;box-shadow:0 0 .5em rgba(0,0,0,.5)}
	#recvsize{color:green}
	#sts{color:brown}
	#banner{display:block;height:2em}
	#hldr{margin-left:auto;margin-right:auto}
</style>
<t id=banner></t>
<table id=hldr><tr><td>
<div id=scr tabindex=0 onkeydown="keys=new Uint8Array([0,event.keyCode]);return true;" onkeyup="keys=new Uint8Array([0,0]);return true;"></div>
<output id=sts></output>  <output id="recvsize"></output>  <a href="javascript:stop()">off</a><a href="javascript:start()">on</a> <a href="javascript:reset()">reset</a> <output id="outp"></output>
</td></tr></table>
use keys  jiop to move medusa

<script>
$=document.all;
var keys=new Uint8Array([0,0]);
var ison=false;
var frameno=0;

start();

function start(){
	if(ison){alert("already on");return;}
	ison=true;
	$.sts.value="on";
	frameno=0;
	ws=new WebSocket("ws://"+location.host+"/medusa.porta");
//	ws.binaryType="arraybuffer";
	ws.onopen=function(e){p(" porta");ws.send(keys);}
	ws.onmessage=function(e){
		frameno++;
		onframe();
		$.recvsize.value="frame: "+frameno+"  "+e.data.length+" B  "+onframe.fps+" fps";
//		var ua=new DataView(e.data);
		var cmd=e.data.substring(0,1);
		var dat=e.data.substring(1);
//		console.log("command: "+cmd);
		if(cmd==0){
			var p=0;
			var s='';
			for(var y=0;y<40;y++){
				s+=dat.substring(p,p+80);
				s+='\n';
				p+=80;
			}
//			console.log(s);
			$.scr.innerHTML=s;
		}else if(cmd==49){
//			console.log('text len: '+e.data.byteLength);
			var str=String.fromCharCode.apply(null,new Uint8Array(dat));
//			console.log(str);
			$.sts.value=str;
			return;
		}
//		console.log(keys[1]);
		ws.send(keys);
		banner_update();
	};
	ws.onerror=function(e){alert("websocket error");};
	$.scr.focus();
}
var last_time_banner_was_updated=new Date();
function banner_update(){
	var now=new Date();
	if(now-last_time_banner_was_updated<5000)return;
	last_time_banner_was_updated=now;
	var s="medusa ascii game";
	var size=s.length;
	var htm='';
	for(var i=0;i<size;i++){
		var ch=s.substring(i,i+1);
//		console.log(ch);
		var r=Math.random()+2.5;
		var c=Math.round(Math.random()*0xffffff);
		var chex=c.toString(16);
		var lt="<span style='font-size:"+r+"em;color:#"+chex+"'>"+ch+"</span>";
//		console.log(lt);
		htm+=lt;
	}
//	console.log(r);
	$.banner.innerHTML=htm;
}
function stop(){
	ison=false;
	ws.close();
	$.outp.value="";
	$.sts.value="off";
//	$.scr.focus();
}
function compile(){
	ws.send("1"+$.src.value);
	$.scr.focus();
}
function reset(){
	ws.send("2");
	$.scr.focus();
}
function p(txt){$.outp.value+=txt;}
function onframe(){
	var t=new Date().getTime();
	var dt=t-onframe.t0;
//	console.log(dt+"   "+onframe.fps+"    "+onframe.f0+"   "+frameno);
	if(dt>1000){
		onframe.t0=t;
		var df=frameno-onframe.f0;
		onframe.f0=frameno;
		onframe.fps=Math.floor(dt==0?0:df*1000/dt);
	}
}
onframe.t0=0;
onframe.f0=0;
onframe.fps=0;
</script>